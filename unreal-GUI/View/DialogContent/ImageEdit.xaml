<UserControl x:Class="unreal_GUI.View.DialogContent.ImageEdit"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:unreal_GUI.View.DialogContent"
             xmlns:ui="http://schemas.inkore.net/lib/ui/wpf/modern"
             xmlns:converters="clr-namespace:unreal_GUI.Converters"
             mc:Ignorable="d">

    <UserControl.Resources>
        <!-- 空值到可见性的转换器 -->
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
        <converters:NullToVisibilityInverterConverter x:Key="NullToVisibilityInverterConverter" />
    </UserControl.Resources>

    <Grid>
        <!-- 标题和说明 -->
        <StackPanel x:Name="Title" Margin="20,20,20,10">
            <TextBlock Text="图片剪裁工具" FontSize="20" FontWeight="Bold" />
            <TextBlock Text="本工具用于将图片剪裁为3:1比例，适用于类别(Categories)图标。" 
                       Margin="0,5,0,0" 
                       FontSize="14" 
                        />
        </StackPanel>

        <!-- 图片预览区域 -->
        <Border x:Name="PicturePreview" 
                Margin="20,80,20,140" 
                
                BorderThickness="1">
            <Grid x:Name="PreviewGrid" >


                <!-- 图片容器 -->
                <Grid x:Name="ImageContainer" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <!-- 裁剪遮罩层 -->
                    <Grid x:Name="CropOverlay" Opacity="0.5" Visibility="{Binding ShowCropGuide}">
                        <!-- 左侧遮罩 -->
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="300" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*" />
                            <RowDefinition Height="100" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <!-- 填充除了3:1区域外的遮罩 -->
                        <Rectangle Grid.Column="0" Grid.Row="0" Grid.ColumnSpan="3" Grid.RowSpan="3" />
                        <!-- 中间透明区域 -->
                        <Rectangle Grid.Column="1" Grid.Row="1" Fill="Transparent" />

                        <!-- 裁剪框边框 -->
                        <Rectangle Grid.Column="1" Grid.Row="1" 
                               
                               StrokeThickness="2" 
                               StrokeDashArray="5,3" />
                    </Grid>

                    <!-- 图片显示 -->
                    <Image x:Name="PreviewImage" 
                       Source="{Binding ImageSource}" 
                       Stretch="Uniform" 
                       Visibility="{Binding ImageSource, Converter={StaticResource NullToVisibilityConverter}}" />

                    <!-- 无图片提示 -->
                    <TextBlock x:Name="NoImageText" 
                           Text="请选择一张图片" 
                           HorizontalAlignment="Center" 
                           VerticalAlignment="Center" 
                           FontSize="16"                            
                           Visibility="{Binding ImageSource, Converter={StaticResource NullToVisibilityInverterConverter}}" />
                </Grid>
            </Grid>
        </Border>

        <!-- 图片信息 -->
        <Grid x:Name="InfoGrid" 
              Margin="20,500,20,80" 
              VerticalAlignment="Top">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <TextBlock Text="尺寸: " FontSize="14"  />
            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <TextBlock Text="{Binding ImageWidth}" 
                            FontSize="14" 
                             />
                <TextBlock Text=" × " 
                            FontSize="14" 
                             />
                <TextBlock Text="{Binding ImageHeight}" 
                            FontSize="14" 
                             />
            </StackPanel>

            <TextBlock Grid.Column="2" 
                       Text="剪裁比例: 3:1" 
                       FontSize="14" 
                       
                       Margin="20,0,0,0" />
        </Grid>

        <!-- 底部控制区 -->
        <Grid x:Name="ControlGrid" Margin="20,540,20,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="200" />
                <ColumnDefinition Width="100" />
                <ColumnDefinition Width="100" />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- 左侧按钮 -->


            <!-- 缩放控制 -->
            <CheckBox x:Name="PNGCompress" Content="启用压缩" HorizontalAlignment="Center" />


            <!-- 缩放控制 -->
            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                <TextBlock Text="缩放: " 
                           Margin="0,0,5,0" 
                           FontSize="14" VerticalAlignment="Center" 
                            />
                <TextBlock x:Name="ZoomText" 
                           Text="100%" 
                           Margin="0,0,5,0" 
                           FontSize="14" 
                           MinWidth="40" VerticalAlignment="Center" 
                            />
                <Slider x:Name="ZoomSlider" 
                        Minimum="0.1" 
                        Maximum="3.0" 
                        Value="1.0" 
                        SmallChange="0.1" 
                        LargeChange="0.5" 
                        Width="120"
                        ValueChanged="ZoomSlider_ValueChanged" />
            </StackPanel>

            <!-- 右侧按钮 -->
            <Button x:Name="ResetZoomButton" 
                   Grid.Column="2" 
                   Content="重置缩放" 
                   Margin="10,0" 
                  />

            <Button x:Name="SaveCroppedButton" 
                   Grid.Column="3" 
                   Content="保存剪裁" 
                   Margin="10,0" 
                   
                 
                   />
        </Grid>
    </Grid>
</UserControl>
